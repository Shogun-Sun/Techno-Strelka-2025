<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Карта</title>
    <link rel="stylesheet" href="./css/out.css">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=ваш_api_ключ&lang=ru_RU" type="text/javascript"></script>
</head>



<body class="font-sans antialiased">
    <nav class="fixed top-0 w-full py-4 bg-black flex flex-row justify-between px-4 z-50 items-center">
        <div id="logo">
            <img src="./pictures/t2_Logo_White_CMYK.png" alt="t2" class="w-10 h-auto">
        </div>
        <div class="flex bg-gray-200 rounded-lg overflow-hidden shadow-md relative px-3 py-1 gap-6">
            <div>
                <label class="w-22 text-center block text-lg text-black border">Покрытие</label>
                <input type="radio" name="test" class="hidden">
            </div>
            <div>
                <label class="w-22 text-center block text-lg text-black border">Отзывы</label>
                <input type="radio" name="test" class="hidden">
            </div>
            <div class="absolute h-full py-1 w-25 rounded-xl top-0 left-3 -z-10"> 
                <div class="w-full h-full bg-white"></div>               
            </div>
        </div>
        <button id="login" class="text-base font-bold text-black bg-white rounded-lg px-3 py-1 hover:bg-gray-100">
            Войти
        </button>
    </nav>
    <div id="map" class="w-full h-screen"></div>
    
    <button id="addReviewBtn" class="fixed bottom-8 right-8 z-50 bg-gray-900 text-white px-6 py-3 rounded-xl shadow-lg hover:bg-gray-800 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
        + Добавить отзыв
    </button>

    <div id="reviewModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-white/1 backdrop-blur-sm">
        <div class="bg-white rounded-2xl p-8 w-full max-w-md relative mx-4">
            <button id="closeModal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl">
                &times;
            </button>
            
            <h2 class="text-2xl font-bold text-gray-900 mb-6">Оставить отзыв</h2>
            
            <div class="mb-6">
                <label class="block text-gray-700 mb-2">Ваш телефон</label>
                <div class="flex flex-row gap-3 items-center text-3xl font-bold text-gray-950">
                   +7 950 199 70 85
                </div>
            </div>
            
            <!-- Поле для отзыва -->
            <div class="mb-6">
                <label for="reviewText" class="block text-gray-700 mb-2">Ваш отзыв</label>
                <textarea id="reviewText" rows="4" class="w-full h-fit max-h-70 min-h-10 px-4 py-3 border rounded-xl
                 focus:ring-2 focus:ring-gray-500 text-lg text-gray-950 p-2 font-semibold
                 focus:border-transparent" placeholder="Напишите ваш отзыв здесь..." autosi></textarea>
            </div>
            
            <!-- Кнопка отправки -->
            <button id="submitReview" class="w-full flex items-center justify-center text-xl font-semibold bg-gray-950 text-white py-3 rounded-xl hover:bg-gray-800 
            transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50">
                Отправить отзыв
            </button>
        </div>
    </div>

    <script>
        // Инициализация карты
        ymaps.ready(init);
        
        let map;
        let userLocation = [55.751574, 37.573856];
        let userPlacemark = null;
        
        function init() {
            map = new ymaps.Map("map", {
                center: [55.751574, 37.573856], // Москва по умолчанию
                zoom: 12
            });
            
            // Определение местоположения пользователя
            ymaps.geolocation.get({
                provider: 'browser',
                mapStateAutoApply: true
            }).then(function (result) {
                userLocation = result.geoObjects.get(0).geometry.getCoordinates();
                map.setCenter(userLocation, 15);
                
                // Добавляем метку пользователя
                userPlacemark = new ymaps.Placemark(userLocation, {}, {
                    preset: 'islands#blueDotIcon'
                });
                map.geoObjects.add(userPlacemark);
            });
        }
        
        // Элементы интерфейса
        const addReviewBtn = document.getElementById('addReviewBtn');
        const reviewModal = document.getElementById('reviewModal');
        const closeModal = document.getElementById('closeModal');
        const submitReview = document.getElementById('submitReview');
        const phoneInputs = [
            document.getElementById('phone1'),
            document.getElementById('phone2'),
            document.getElementById('phone3'),
            document.getElementById('phone4'),
            document.getElementById('phone5'),
            document.getElementById('phone6'),
            document.getElementById('phone7'),
            document.getElementById('phone8'),
            document.getElementById('phone9'),
            document.getElementById('phone10')
        ];
        const reviewText = document.getElementById('reviewText');
        
        // Открытие модального окна
        addReviewBtn.addEventListener('click', () => {
            reviewModal.classList.remove('hidden');
            reviewModal.classList.add('flex');
            phoneInputs[0].focus();
        });
        
        // Закрытие модального окна
        closeModal.addEventListener('click', () => {
            reviewModal.classList.add('hidden');
            reviewModal.classList.remove('flex');
        });
        
        // Обработка ввода телефона
        phoneInputs.forEach((input, index) => {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '');
                if (this.value.length === 1 && index < phoneInputs.length - 1) {
                    phoneInputs[index + 1].focus();
                }
            });
            
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace') {
                    if (this.value.length === 0 && index > 0) {
                        phoneInputs[index - 1].focus();
                    } else if (this.value.length > 0) {
                        this.value = '';
                    }
                }
            });
        });
        
        // Отправка отзыва
        submitReview.addEventListener('click', () => {
            const phone = '7' + phoneInputs.map(input => input.value).join('');
            const review = reviewText.value.trim();
            
            if (phone.length !== 11) {
                alert('Пожалуйста, введите корректный номер телефона');
                return;
            }
            
            if (!review) {
                alert('Пожалуйста, напишите ваш отзыв');
                return;
            }
            
            if (!userLocation) {
                alert('Не удалось определить ваше местоположение');
                return;
            }
            
            // Создаем метку с отзывом на карте
            const reviewPlacemark = new ymaps.Placemark(userLocation, {
                balloonContent: `
                    <div class="p-2 overflow-y-scroll h-auto ">
                        <h3 class="font-bold mb-1">Отзыв</h3>
                        <p class="mb-2">${review}</p>
                        <p class="text-sm text-gray-600">Телефон: +${phone}</p>
                    </div>
                `
            }, {
                preset: 'islands#greenIcon'
            });
            
            map.geoObjects.add(reviewPlacemark);
            reviewPlacemark.balloon.open();
            
            // Здесь должна быть реальная отправка данных на сервер
            console.log('Отправка отзыва:', {
                phone: phone,
                review: review,
                coordinates: userLocation
            });
            
            // Закрываем модальное окно и очищаем форму
            reviewModal.classList.add('hidden');
            reviewModal.classList.remove('flex');
            phoneInputs.forEach(input => input.value = '');
            reviewText.value = '';
            
            // Показываем уведомление
            alert('Спасибо за ваш отзыв! Он отмечен на карте.');
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const smsButton = document.getElementById('sms-button');
            const passwordButton = document.getElementById('password-button');
    
            smsButton.addEventListener('click', function() {
                smsButton.classList.add('active');
                passwordButton.classList.remove('active');
            });
    
            passwordButton.addEventListener('click', function() {
                passwordButton.classList.add('active');
                smsButton.classList.remove('active');
            });
        });
    </script>
</body>
</html>